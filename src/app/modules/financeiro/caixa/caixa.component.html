<div class="page-header">
  <h1>ðŸ’µ Caixa - Dashboard Financeiro</h1>
  <div class="header-actions">
    <button class="btn btn-primary btn-small" (click)="sincronizarManual()" [disabled]="loading">
      ðŸ”„ Sincronizar
    </button>
    <button class="btn btn-primary btn-small" (click)="novaContaReceber()">
      âž• Receber
    </button>
    <button class="btn btn-secondary btn-small" (click)="novaContaPagar()">
      âž• Pagar
    </button>
  </div>
</div>

<div *ngIf="alertMessage" class="alert alert-{{alertType}}">
  {{ alertMessage }}
</div>

<!-- Resumo Geral do Caixa -->
<div class="resumo-cards">
  <div class="resumo-card card-saldo">
    <h3>Saldo Atual</h3>
    <p class="valor">
      {{ formatarMoeda(saldoAtual !== undefined && saldoAtual !== null ? saldoAtual : 0) }}
    </p>
  </div>
  <div class="resumo-card">
    <h3>Total Entradas</h3>
    <p class="valor valor-entrada">{{ formatarMoeda(totalEntradas) }}</p>
  </div>
  <div class="resumo-card">
    <h3>Total SaÃ­das</h3>
    <p class="valor valor-saida">{{ formatarMoeda(totalSaidas) }}</p>
  </div>
  <div class="resumo-card">
    <h3>Saldo do Dia</h3>
    <p class="valor" [ngClass]="saldoDia >= 0 ? 'valor-positivo' : 'valor-negativo'">
      {{ formatarMoeda(saldoDia) }}
    </p>
  </div>
</div>

<!-- Resumo Contas a Receber -->
<div class="card">
  <div class="card-header">
    <h2>ðŸ“¥ Contas a Receber</h2>
    <button class="btn btn-primary btn-small" (click)="verContasReceber()">
      Ver Todas
    </button>
  </div>
  <div class="resumo-cards">
    <div class="resumo-card">
      <h3>Pendente</h3>
      <p class="valor valor-pendente">{{ formatarMoeda(totalReceberPendente) }}</p>
    </div>
    <div class="resumo-card">
      <h3>Pago</h3>
      <p class="valor valor-pago">{{ formatarMoeda(totalReceberPago) }}</p>
    </div>
    <div class="resumo-card">
      <h3>Vencido</h3>
      <p class="valor valor-vencido">{{ formatarMoeda(totalReceberVencido) }}</p>
    </div>
  </div>
</div>

<!-- Resumo Contas a Pagar -->
<div class="card">
  <div class="card-header">
    <h2>ðŸ“¤ Contas a Pagar</h2>
    <button class="btn btn-primary btn-small" (click)="verContasPagar()">
      Ver Todas
    </button>
  </div>
  <div class="resumo-cards">
    <div class="resumo-card">
      <h3>Pendente</h3>
      <p class="valor valor-pendente">{{ formatarMoeda(totalPagarPendente) }}</p>
    </div>
    <div class="resumo-card">
      <h3>Pago</h3>
      <p class="valor valor-pago">{{ formatarMoeda(totalPagarPago) }}</p>
    </div>
    <div class="resumo-card">
      <h3>Vencido</h3>
      <p class="valor valor-vencido">{{ formatarMoeda(totalPagarVencido) }}</p>
    </div>
  </div>
</div>

<!-- MovimentaÃ§Ãµes do Caixa -->
<div class="card">
  <div class="card-header">
    <h2>ðŸ’µ MovimentaÃ§Ãµes do Caixa</h2>
  </div>
  <div class="filters-bar">
    <input
      type="date"
      [(ngModel)]="dataFiltro"
      (change)="filtrarMovimentacoes()"
      class="filter-select"
    />
    <select [(ngModel)]="tipoFiltro" (change)="filtrarMovimentacoes()" class="filter-select">
      <option value="">Todos os tipos</option>
      <option value="entrada">Entradas</option>
      <option value="saida">SaÃ­das</option>
    </select>
  </div>

  <div *ngIf="loading" class="loading">
    Carregando movimentaÃ§Ãµes...
  </div>

  <div *ngIf="!loading && movimentacoesFiltradas.length === 0" class="empty-state">
    <p>Nenhuma movimentaÃ§Ã£o encontrada.</p>
  </div>

  <table *ngIf="!loading && movimentacoesFiltradas.length > 0" class="table">
    <thead>
      <tr>
        <th>Data</th>
        <th>Tipo</th>
        <th>DescriÃ§Ã£o</th>
        <th>Valor</th>
        <th>Forma Pagamento</th>
        <th>ReferÃªncia</th>
        <th>ObservaÃ§Ãµes</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let movimentacao of movimentacoesFiltradas">
        <td>{{ formatarData(movimentacao.data_movimentacao) }}</td>
        <td>
          <span class="badge" [ngClass]="getTipoBadgeClass(movimentacao.tipo)">
            {{ getTipoLabel(movimentacao.tipo) }}
          </span>
        </td>
        <td>{{ movimentacao.descricao }}</td>
        <td [ngClass]="movimentacao.tipo === 'entrada' ? 'valor-entrada' : 'valor-saida'">
          {{ movimentacao.tipo === 'entrada' ? '+' : '-' }}{{ formatarMoeda(movimentacao.valor) }}
        </td>
        <td>{{ movimentacao.forma_pagamento || '-' }}</td>
        <td>
          <button 
            *ngIf="temReferencia(movimentacao)" 
            class="btn btn-primary btn-small" 
            (click)="verContaRelacionada(movimentacao)"
            title="Ver conta relacionada"
            style="font-size: 11px; padding: 4px 8px;"
          >
            {{ getReferenciaLabel(movimentacao) }}
          </button>
          <span *ngIf="!temReferencia(movimentacao)">-</span>
        </td>
        <td>{{ movimentacao.observacoes || '-' }}</td>
      </tr>
    </tbody>
  </table>
</div>

