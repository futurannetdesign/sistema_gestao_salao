<div class="page-header">
  <h1>{{ usuarioId ? 'Editar' : 'Novo' }} Usu√°rio</h1>
  <button class="btn btn-secondary" (click)="cancelar()">Cancelar</button>
</div>

<div *ngIf="alertMessage" class="alert alert-{{alertType}}">
  {{ alertMessage }}
</div>

<div class="card">
  <form [formGroup]="usuarioForm" (ngSubmit)="salvar()">
    <div class="form-row">
      <div class="form-group">
        <label>Nome Completo *</label>
        <input type="text" formControlName="nome" class="form-control" />
        <span *ngIf="usuarioForm.get('nome')?.invalid && usuarioForm.get('nome')?.touched" class="error-message">
          Nome √© obrigat√≥rio
        </span>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label>Email *</label>
        <input type="email" formControlName="email" class="form-control" />
        <span *ngIf="usuarioForm.get('email')?.invalid && usuarioForm.get('email')?.touched" class="error-message">
          Email inv√°lido
        </span>
      </div>
      <div class="form-group">
        <label>Perfil *</label>
        <select formControlName="perfil" class="form-control">
          <option value="funcionario">Funcion√°rio</option>
          <option value="admin">Administrador</option>
        </select>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label>
          {{ usuarioId ? 'Nova Senha' : 'Senha' }} 
          <span *ngIf="!usuarioId">*</span>
          <small *ngIf="usuarioId">(deixe em branco para manter a senha atual)</small>
        </label>
        <div style="position: relative;">
          <input 
            [type]="mostrarSenha ? 'text' : 'password'" 
            formControlName="senha" 
            class="form-control" 
            [placeholder]="usuarioId ? 'Deixe em branco para manter' : 'M√≠nimo 6 caracteres'"
          />
          <button 
            type="button" 
            class="btn-toggle-password" 
            (click)="mostrarSenha = !mostrarSenha"
            title="{{ mostrarSenha ? 'Ocultar' : 'Mostrar' }} senha"
          >
            {{ mostrarSenha ? 'üëÅÔ∏è' : 'üëÅÔ∏è‚Äçüó®Ô∏è' }}
          </button>
        </div>
        <span *ngIf="usuarioForm.get('senha')?.invalid && usuarioForm.get('senha')?.touched" class="error-message">
          <span *ngIf="usuarioForm.get('senha')?.errors?.['required']">Senha √© obrigat√≥ria</span>
          <span *ngIf="usuarioForm.get('senha')?.errors?.['minlength']">Senha deve ter no m√≠nimo 6 caracteres</span>
        </span>
      </div>
      <div class="form-group">
        <label>Confirmar Senha <span *ngIf="!usuarioId">*</span></label>
        <input 
          [type]="mostrarSenha ? 'text' : 'password'" 
          formControlName="confirmarSenha" 
          class="form-control" 
          placeholder="Digite a senha novamente"
        />
        <span *ngIf="usuarioForm.get('confirmarSenha')?.invalid && usuarioForm.get('confirmarSenha')?.touched" class="error-message">
          <span *ngIf="usuarioForm.get('confirmarSenha')?.errors?.['required']">Confirma√ß√£o de senha √© obrigat√≥ria</span>
          <span *ngIf="usuarioForm.get('confirmarSenha')?.errors?.['mismatch']">As senhas n√£o coincidem</span>
        </span>
      </div>
    </div>

    <div class="form-group">
      <label>
        <input type="checkbox" formControlName="ativo" />
        Usu√°rio ativo
      </label>
      <small class="form-help">Usu√°rios inativos n√£o podem fazer login no sistema</small>
    </div>

    <div class="form-actions">
      <button type="button" class="btn btn-secondary" (click)="cancelar()" [disabled]="loading">
        Cancelar
      </button>
      <button type="submit" class="btn btn-primary" [disabled]="loading || usuarioForm.invalid">
        <span *ngIf="!loading">{{ usuarioId ? 'Atualizar' : 'Criar' }} Usu√°rio</span>
        <span *ngIf="loading">Salvando...</span>
      </button>
    </div>
  </form>
</div>

